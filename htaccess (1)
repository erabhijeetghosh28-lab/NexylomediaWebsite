# ---------------------------------------------------------
# Nexylomedia .htaccess Configuration
# SEO-friendly URLs, HTTPS, sitemap access, and rewrite safety
# ---------------------------------------------------------

# Disable directory listing & Multiviews (prevents weird matches)
Options -Indexes -Multiviews

<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /

# ---------------------------------------------------------
# 1️⃣ Allow sitemap.xml & robots.txt (Fix for HTTP 503 Error)
# ---------------------------------------------------------
# Ensures Googlebot and others can directly access sitemap & robots
RewriteCond %{REQUEST_URI} ^/sitemap\.xml$ [OR]
RewriteCond %{REQUEST_URI} ^/robots\.txt$
RewriteRule .* - [L]

# ---------------------------------------------------------
# 2️⃣ Fix accidental cPanel full-path URLs (e.g. /home/USER/public_html/)
# ---------------------------------------------------------
RewriteRule ^home/[^/]+/public_html/(.*)$ /$1 [R=301,L]

# ---------------------------------------------------------
# 3️⃣ Force HTTPS and remove "www"
# ---------------------------------------------------------
RewriteCond %{HTTPS} !=on [OR]
RewriteCond %{HTTP_HOST} ^www\.nexylomedia\.com$ [NC]
RewriteRule ^(.*)$ https://nexylomedia.com/$1 [R=301,L]

# ---------------------------------------------------------
# 4️⃣ Redirect /index.html → /
# ---------------------------------------------------------
RewriteCond %{THE_REQUEST} \s/+(index\.html)[\s?] [NC]
RewriteRule ^index\.html$ / [R=301,L]

# ---------------------------------------------------------
# 5️⃣ Remove .html from visible URLs (redirect .html → clean)
# ---------------------------------------------------------
RewriteCond %{THE_REQUEST} \s/+(.+?)\.html[\s?] [NC]
RewriteRule ^ %1 [R=301,L]

# ---------------------------------------------------------
# 6️⃣ Map clean URLs to actual .html files
# ---------------------------------------------------------
# About & Contact pages
RewriteRule ^about/?$ about.html [L]
RewriteRule ^contact/?$ contact.html [L]

# Services folder
RewriteRule ^services/?$ services/digital-marketing.html [L]
RewriteRule ^services/([A-Za-z0-9\-]+)/?$ services/$1.html [L,NC]

# ---------------------------------------------------------
# 7️⃣ Auto-append .html when a file exists but extension missing
# ---------------------------------------------------------
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME}\.html -f
RewriteRule ^(.+)$ $1.html [L]

</IfModule>

# ---------------------------------------------------------
# 8️⃣ Serve correct MIME types (fixes sitemap 503 / parse errors)
# ---------------------------------------------------------
AddType application/xml .xml
AddType text/plain .txt

# ---------------------------------------------------------
# 9️⃣ (Optional) Custom 404 Page
# ---------------------------------------------------------
# ErrorDocument 404 /404.html